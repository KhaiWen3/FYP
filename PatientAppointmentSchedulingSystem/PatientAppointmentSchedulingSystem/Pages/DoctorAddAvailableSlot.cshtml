@page
@model PatientAppointmentSchedulingSystem.Pages.DoctorAddAvailableSlotModel
@{
    Layout = "_DoctorLayout";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Doctor Availability Management - MediBook</title>

    <!-- ======= Google Font =======-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&amp;display=swap" rel="stylesheet">
    <!-- End Google Font-->
    <!-- ======= Styles =======-->
    <link href="/vendors/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="/vendors/bootstrap-icons/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="/vendors/glightbox/glightbox.min.css" rel="stylesheet">
    <link href="/vendors/swiper/swiper-bundle.min.css" rel="stylesheet">
    <link href="/vendors/aos/aos.css" rel="stylesheet">
    <!--I ADD THIS LINE⬇-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- End Styles-->
    <!-- ======= Theme Style =======-->
    <link href="/css/doctor.css" rel="stylesheet">
    <!-- End Theme Style-->

    <!-- ======= Apply theme =======-->
    <script>
        // Apply the theme as early as possible to avoid flicker
        (function() {
        const storedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-bs-theme', storedTheme);
        })();
    </script>

    <style>
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            border: none;
            font-size: 0.9rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

            .btn-primary:hover {
                background-color: var(--hover-color);
            }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--gray-medium);
            color: var(--dark-color);
        }

            .btn-outline:hover {
                background-color: var(--gray-light);
            }

        .btn-icon {
            margin-right: 8px;
        }

        .btn-secondary {
            background-color: var(--accent-color);
            color: white;
        }

            .btn-secondary:hover {
                background-color: #2389da;
            }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

            .btn-danger:hover {
                background-color: #c82333;
            }

        .subpage-title {
            display: block; /* block so width works */
            width: 100%; /* fill available space */
            max-width: 1200px; /* but cap at 1200px */
            margin: 20px auto; /* center the block */
            text-align: center; /* center the text inside */
            background: #CFE3FF !important;
            color: #0056b3 !important;
            padding: 12px 16px;
            border-radius: 7px;
            font-weight: 600;
            font-size: 48px;
            padding-top: 24px !important;
            padding-bottom: 24px !important;
            background-color: rgba(var(--inverse-color-rgb), 0.03);
        }

            .subpage-title .subpage-sub {
                font-size: 0.9rem; /* make it smaller */
                line-height: 1.4;
                margin: 6px 0 0; /* tighter spacing */
                color: var(--bs-body-color);
            }
    </style>
</head>
<body>
    <!-- ======= Site Wrap =======-->
    <div class="site-wrap">
        <!-- ======= Main =======-->
        <main>
            <section class="hero__v6 section" id="home" style="padding:100px 0 0 0 !important">
                <!-- ======= Everything Start from HERE!! =======-->

                <div class="container">
                    <div class="content-wrapper">
                        @if (TempData["AlertMsg"] != null)
                        {
                            <script>
                                alert("@TempData["AlertMsg"]");
                            </script>
                        }
                        <div class="container">
                            <div class="subpage-title" data-aos="fade-up" data-aos-delay="0">
                                <span>Add Available Time Slot</span>
                                @* <p class="subpage-sub">@Model.DoctorName</p> *@
                                @* <p class="search-sub">@Model.DoctorSpecialtyName</p> *@
                            </div>

                            <div class="content-wrapper">
                                @* <div class="sidebar">
                                    <div class="doctor-profile"> *@
                                        @* <img src="#" alt="Dr. Edalin Hendry" class="profile-image"> *@
                                        @* <div class="status-indicator"></div> *@
                                        <!--Retrieve-->
                                        @* <div class="doctor-info">
                                            <div class="doctor-name">@Model.DoctorName</div>
                                            <div class="doctor-specialty">@Model.DoctorSpecialty</div>
                                        </div> *@
                                @*     </div>
                                </div> *@

                                <div class="main-content">
                                    <div class="tab-header">
                                        <div class="tab active">General Availability</div>

                                    </div>

                                    <div class="section-header">
                                        <h2 class="section-title">Select Available Slots</h2>
                                    </div>

                                    <div class="legend">
                                        <div class="legend-item">
                                            <div class="legend-color video-color"></div>
                                            Video Visit
                                        </div>
                                        <div class="legend-item">
                                            <div class="legend-color inperson-color"></div>
                                            In-Person Visit
                                        </div>
                                        <div class="legend-item">
                                            <div class="legend-color isbooked-color"></div>
                                            Is Booked
                                        </div>
                                    </div>

                                    <div class="action-buttons">
                                        <button class="btn btn-outline" id="openModalBtn">
                                            <i class="fas fa-plus btn-icon"></i> Add Slots
                                        </button>
                                    </div>

                                    <!--Display Slots Added-->
                                    @if (Model.AvailableSlots != null && Model.AvailableSlots.Any())
                                    {
                                        @foreach (var dayGroup in Model.AvailableSlots.GroupBy(s => s.AppointmentDate.Date))
                                        {
                                            <div class="slots-container">
                                                <div class="day-header">
                                                    <div class="day-name">@dayGroup.Key.ToString("dddd, dd MMM yyyy")</div>
                                                </div>

                                                <div class="slots-grid">
                                                    @foreach (var slot in dayGroup)
                                                    {
                                                        string slotClass = slot.AppointmentStatus == 1 ? "isbooked" : (slot.AppointmentType == "Video" ? "video" : "in-person");

                                                        <div class="time-slot @slotClass" data-slot-id="@slot.SlotId">
                                                            <button class="delete-icon" onclick="confirmDelete('@slot.SlotId')">
                                                                <i class="fas fa-times"></i>
                                                            </button>
                                                            <div class="slot-time">
                                                                @slot.AptStartTime.ToString("HH:mm tt") - @slot.AptEndTime.ToString("HH:mm tt")

                                                            </div>
                                                            <div class="slot-type">
                                                                @if (slot.AppointmentStatus == 1)
                                                                {
                                                                    <p><i class="fas fa-check-circle"></i> Booked</p>
                                                                }
                                                                else if (slot.AppointmentType == "Video")
                                                                {
                                                                    <p><i class="fas fa-video"></i> Video Visit</p>
                                                                }
                                                                else
                                                                {
                                                                    <p><i class="fas fa-user-md"></i> In-Person</p>
                                                                }
                                                            </div>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        <p>No slots available.</p>
                                    }
                            </div>
                        </div>

                        <!-- Add Time Slot Modal -->
                        <div class="modal" id="addSlotModal" style="display: none;">
                            <div class="modal-content" style="margin:auto; margin-top:150px !important;">
                                <form method="post" asp-antiforgery="true">
                                    @Html.AntiForgeryToken()
                                    <div class="modal-header">
                                        <div class="modal-title">Add Time Slots</div>
                                        <div class="modal-close" id="closeModalBtn">&times;</div>
                                    </div>
                                    <div class="modal-body">
                                        <div asp-validation-summary="All" class="text-danger mb-2"></div>
                    
                                        <!--hidden doctorid field-->
                                        <div class="form-group">
                                            <input type="hidden" asp-for="DoctorId"/>
                                        </div>

                                        <div class="form-group">
                                            <label for="Input.AppointmentDate">Select Date</label>
                                            <input asp-for="Input.AppointmentDate" type="date" class="form-control" />
                                            <span asp-validation-for="Input.AppointmentDate" class="text-danger"></span>
                                        </div>

                                        <div class="time-inputs">
                                            <div class="form-group">
                                                <label for="Input.StartTime">Start Time</label>
                                                <input asp-for="Input.AptStartTime" type="time" class="form-control">
                                            </div>
                                            <div class="form-group">
                                                <label for="Input.EndTime">End Time</label>
                                                <input asp-for="Input.AptEndTime" type="time" class="form-control">
                                            </div>
                                        </div>
                     
                                        <div class="form-group">
                                            <label>Appointment Type</label>
                                            <div class="appointment-types">
                                                <label class="type-option">
                                                    <input asp-for="Input.AppointmentType" type="radio" value="Video" checked/> Video Visit
                                                </label>
                                                <label class="type-option">
                                                    <input asp-for="Input.AppointmentType" type="radio" value="InPerson" /> In-Person Visit
                                                </label>
                                            </div>
                                            <span asp-validation-for="Input.AppointmentType" class="text-danger"></span>
                                        </div>

                                        <div class="form-group">
                                            <input type="submit" value="Add Slot" class="btn btn-primary" />
                                        </div>
                                    </div>
                                </form>
                            </div>
                         </div>
                    </div>
                </div>
            </section>
        </main>
</body>

<script>
    document.getElementById("openModalBtn").addEventListener("click", function () {
        document.getElementById("addSlotModal").style.display = "block";
    });

    document.getElementById("closeModalBtn").addEventListener("click", function () {
        document.getElementById("addSlotModal").style.display = "none";
    });

    // Optional: Close the modal if user clicks outside the modal content
    window.addEventListener("click", function (event) {
        const modal = document.getElementById("addSlotModal");
        if (event.target === modal) {
            modal.style.display = "none";
        }
    });

    function confirmDelete(slotId) {
        if (confirm("Are you sure you want to delete this slot?")) {
            deleteSlot(slotId);
        }
    }

    function deleteSlot(slotId) {
        fetch('?handler=Delete&id=' + slotId, {
            method: 'POST',
            headers: {
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
            }
        })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert(result.message);
                    location.reload();
                } else {
                    alert(result.message || "Delete failed");
                }
            })
            .catch(err => console.error("Error deleting slot:", err));
    }
</script>
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}


</html>