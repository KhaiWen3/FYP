@page
@model PatientAppointmentSchedulingSystem.Pages.ProviderDoctorListModel
@{
    Layout = "_ProviderLayout";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to MediBook</title>

    <!-- ======= Google Font =======-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&amp;display=swap" rel="stylesheet">
    <!-- End Google Font-->
    <!-- ======= Styles =======-->
    <link href="/vendors/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="/vendors/bootstrap-icons/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="/vendors/glightbox/glightbox.min.css" rel="stylesheet">
    <link href="/vendors/swiper/swiper-bundle.min.css" rel="stylesheet">
    <link href="/vendors/aos/aos.css" rel="stylesheet">
    <!-- End Styles-->
    <!-- ======= Theme Style =======-->
    <link href="/css/provider.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
    <!-- End Theme Style-->
    <!-- ======= Apply theme =======-->
    <script>
        // Apply the theme as early as possible to avoid flicker
        (function () {
            const storedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-bs-theme', storedTheme);
        })();
    </script>
    <style>
        /* Ensure modal is always on top */
        .modal {
            z-index: 2000 !important;
        }

        .modal-backdrop {
            z-index: 1900 !important;
        }

        /* If your navbar has too high z-index, lower it */
        .navbar {
            z-index: 1000 !important;
        }
    </style>
</head>
<body>
    <!-- ======= Site Wrap =======-->
    <div class="site-wrap">
        <!-- ======= Main =======-->
        <main>

            <section class="hero__v6 section" id="home" style="padding:70px 0 0 0 !important">
                <!-- ======= Everything Start from HERE!! =======-->
                @* <main> *@

                <div class="container">
                    <div class="content-wrapper">
                        @if (TempData["AlertMsg"] != null)
                        {
                            <script>
                                alert("@TempData["AlertMsg"]");
                            </script>
                        }
                        <!-- Main Content -->
                        <div class="container">
                            <section class="py-4">
                                <div class="registration-container" style="max-width:1100px;">
                                    @section Scripts {
                                        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
                                        <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
                                        <script>
                                            $(document).ready(function () {
                                                $('#doctorTable').DataTable({
                                                    scrollx:true,
                                                    initComplete: function () {
                                                        $('#doctorTable').show(); // show only after DataTable is styled
                                                    }
                                                });
                                            });
                                        </script>
                                    }
                                    <div class="table-responsive">
                                        <table id="doctorTable" class="display table table-striped" style="width:100%; display:none;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Specialty</th>
                                                    <th>Medical Service</th>
                                                    <th>Room Number</th>
                                                    <th>Phone Number</th>
                                                    <th>Email</th>
                                                    <th>Language Spoken</th>
                                                    <th>Photo</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var d in Model.DoctorList)
                                                {
                                                    <tr>
                                                        <td>@d.DoctorId</td>
                                                        <td>@d.DoctorFullName</td>
                                                        <td>@d.DoctorSpecialtyName</td>
                                                        <td>@d.DoctorMedicalService</td>
                                                        <td>@d.DoctorRoomNum</td>
                                                        <td>@d.DoctorPhoneNum</td>
                                                        <td>@d.DoctorEmail</td>
                                                        <td>@d.DoctorLanguageSpoken</td>
                                                        <td>
                                                            @if (!string.IsNullOrEmpty(d.DoctorPhoto))
                                                            {
                                                                <img src="@d.DoctorPhoto" alt="Doctor Photo" width="80" height="80" style="object-fit:cover;border-radius:6px;" />
                                                            }
                                                            else
                                                            {
                                                                <span>No Photo</span>
                                                            }
                                                        </td>
                                                        <td>
                                                            <button type="button"
                                                                    class="btn btn-sm btn-outline-primary edit-btn"
                                                                    data-bs-toggle="modal"
                                                                    data-bs-target="#editDoctorModal"
                                                                    data-id="@d.DoctorId"
                                                                    data-name="@d.DoctorFullName"
                                                                    data-specialty="@d.DoctorSpecialtyName"
                                                                    data-medicalservice="@d.DoctorMedicalService"
                                                                    data-room="@d.DoctorRoomNum"
                                                                    data-phone="@d.DoctorPhoneNum"
                                                                    data-email="@d.DoctorEmail"
                                                                    data-language="@d.DoctorLanguageSpoken"
                                                                    data-photo="@d.DoctorPhoto">
                                                                <i class="bi bi-pencil"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    
                                </div>
                            </section>
                        </div>

                        <!--display modal box to update doctor details-->
                        <div class="modal fade" id="editDoctorModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Edit Doctor</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>

                                    <form method="post" enctype="multipart/form-data" asp-page-handler="EditDoctor">
                                        <div class="modal-body">
                                            <input type="hidden" id="DoctorId" name="DoctorId" />

                                            <div class="mb-3">
                                                <label class="form-label">Full Name</label>
                                                <input type="text" class="form-control" id="DoctorFullName" name="DoctorFullName" />
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">Specialty</label>
                                                <input type="text" class="form-control" id="DoctorSpecialtyName" name="DoctorSpecialtyName" />
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">Medical Service</label>
                                                <input type="text" class="form-control" id="DoctorMedicalService" name="DoctorMedicalService" />
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">Room Number</label>
                                                <input type="text" class="form-control" id="DoctorRoomNum" name="DoctorRoomNum" />
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">Phone</label>
                                                <input type="text" class="form-control" id="DoctorPhoneNum" name="DoctorPhoneNum" />
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">Email</label>
                                                <input type="email" class="form-control" id="DoctorEmail" name="DoctorEmail" />
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">Language Spoken</label>
                                                <input type="text" class="form-control" id="DoctorLanguageSpoken" name="DoctorLanguageSpoken" />
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">Photo</label>
                                                <input type="file" class="form-control" name="DoctorPhoto" />
                                                <img id="DoctorPhotoPreview" src="" alt="Preview"
                                                     style="width:80px;height:80px;margin-top:10px;object-fit:cover;border-radius:6px;" />
                                            </div>
                                        </div>

                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-primary">Save changes</button>
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                @* </main> *@
                <!-- End Hero-->
            </section>
            <!-- End Hero-->
        </main>
    </div>

    <!-- ======= Back to Top =======-->
    <button id="back-to-top"><i class="bi bi-arrow-up-short"></i></button>
    <!-- End Back to top-->
    <!-- ======= Javascripts =======-->
    <script src="/vendors/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="/vendors/gsap/gsap.min.js"></script>
    <script src="/vendors/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="/vendors/isotope/isotope.pkgd.min.js"></script>
    <script src="/vendors/glightbox/glightbox.min.js"></script>
    <script src="/vendors/swiper/swiper-bundle.min.js"></script>
    <script src="/vendors/aos/aos.js"></script>
    <script src="/vendors/purecounter/purecounter.js"></script>
    <script src="/js/custom.js"></script>
    <script src="/js/send_email.js"></script>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const editButtons = document.querySelectorAll(".edit-btn");

            editButtons.forEach(btn => {
                btn.addEventListener("click", function () {
                    document.getElementById("DoctorId").value = this.dataset.id;
                    document.getElementById("DoctorFullName").value = this.dataset.name;
                    document.getElementById("DoctorSpecialtyName").value = this.dataset.specialty;
                    document.getElementById("DoctorMedicalService").value = this.dataset.medicalservice;
                    document.getElementById("DoctorRoomNum").value = this.dataset.room;
                    document.getElementById("DoctorPhoneNum").value = this.dataset.phone;
                    document.getElementById("DoctorEmail").value = this.dataset.email;
                    document.getElementById("DoctorLanguageSpoken").value = this.dataset.language;

                    const photoPreview = document.getElementById("DoctorPhotoPreview");
                    if (this.dataset.photo) {
                        photoPreview.src = this.dataset.photo;
                        photoPreview.style.display = "block";
                    } else {
                        photoPreview.style.display = "none";
                    }
                });
            });
        });
    </script>

    <!-- End JavaScripts-->
</body>
</html>
